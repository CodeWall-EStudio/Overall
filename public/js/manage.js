angular.module("ov.services.import",["ov.constant","ov.services.utils"]).service("importService",["$rootScope","$location","$http",function(){var e=function(e,o,t){{var n=(new Date).getTime(),n=(new Date).getTime();Util.object.toUrlencodedString(e)}Http.get("/api/indicator/list?_="+n+"&indicatorGroup="+e.indicatorGroup,null,{responseType:"json"}).success(function(e,t){0===e.code?(console.log("拉学生列表成功!",e),Root.$emit("status.student.load")):Root.$emit("msg.codeshow",e.code),o&&o(e,t)}).error(function(e,o){t&&t(e,o)})};return{getQuotaList:e}}]),angular.module("ov.services.quota",["ov.constant","ov.services.utils"]).service("quotaService",["$rootScope","$location","$http","Util","MSG.ERROR.CODE","STATUS.GROUP.LOAD",function(e,o,t,n,r,i){var a=function(o){o=o||0,e.quotaGroupList.length&&(e.nowQuotaGroup=e.quotaGroupList[o])},c=function(){var o="/api/indicatorgroup/list?term="+e.nowTerm._id;console.log(o);var n=(new Date).getTime();t.get(o+"&t="+n,null,{responseType:"json"}).success(function(o){console.log("拉取指标组成功！",o.result),0===o.err?(e.quotaGroupList=o.result,_.each(o.result,function(o){e.quotaGroupMap[o._id]=o}),a(),e.$emit(i)):e.$emit(r,o.err)}).error(function(){})},s=function(o,i,a){var c=(new Date).getTime(),s=n.object.toUrlencodedString(e.newQuotaGroup);t.post("/api/indicatorgroup/create?_="+c,s,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(o,t){console.log(o),0===o.err?console.log("新建指标组成功!",o):e.$emit(r,o.err),i&&i(o,t)}).error(function(e,o){a&&a(e,o)})},u=function(o,n,i){var a=(new Date).getTime();t.get("/api/indicator/list?_="+a+"&indicatorGroup="+o.indicatorGroup,null,{responseType:"json"}).success(function(o,t){0===o.err?(e.quotaList=o.result,console.log(e.quotaList),console.log("拉指标列表成功!",o)):e.$emit(r,o.err),n&&n(o,t)}).error(function(e,o){i&&i(e,o)})},l=function(e){var o=((new Date).getTime(),"/api/indicator/import"),t=new XMLHttpRequest;t.addEventListener("load",function(){try{var e=JSON.parse(t.responseText);console.log(e)}catch(o){}}),t.addEventListener("error",function(e){console.log("error",e)}),t.open("POST",o),t.send(e)},p=function(e){var o=((new Date).getTime(),"/api/indicatorscore/import"),t=new XMLHttpRequest;t.addEventListener("load",function(){try{var e=JSON.parse(t.responseText);console.log(e)}catch(o){}}),t.addEventListener("error",function(e){console.log("error",e)}),t.open("POST",o),t.send(e)},d=function(o,t,n){var r=e.quotaGroupMap[o].indicators,i=_.sortBy(r,function(e){return n?(console.log("-",e,t),-e[t]):(console.log("+",e,t),+e[t])});e.quotaGroupMap[o].indicators=i};return{setDefQuotaGroup:a,getQuotaGroup:c,createQuotaGroup:s,getQuotaList:u,importQuota:l,importQuotaScore:p,orderQuotaGroup:d}}]),angular.module("ov.services.student",["ov.constant","ov.services.utils"]).service("studentService",["$rootScope","$location","$http",function(){var e=function(e){var o=((new Date).getTime(),"/api/student/import"),t=new XMLHttpRequest;t.addEventListener("load",function(){try{var e=JSON.parse(t.responseText);console.log(e)}catch(o){}}),t.addEventListener("error",function(e){console.log("error",e)}),t.open("POST",o),t.send(e)};return{importStudent:e}}]),angular.module("ov.services.teacher",["ov.constant","ov.services.utils"]).service("teacherService",["$rootScope","$location","$http",function(e,o,t){var n=function(e){var o=((new Date).getTime(),"/api/teachergroup/import"),t=new XMLHttpRequest;t.addEventListener("load",function(){try{var e=JSON.parse(t.responseText);console.log(e)}catch(o){}}),t.addEventListener("error",function(e){console.log("error",e)}),t.open("POST",o),t.send(e)},r=function(e){var o=((new Date).getTime(),"/api/teacher/import"),t=new XMLHttpRequest;t.addEventListener("load",function(){try{var e=JSON.parse(t.responseText);console.log(e)}catch(o){}}),t.addEventListener("error",function(e){console.log("error",e)}),t.open("POST",o),t.send(e)},i=function(){var o="/api/teachergroup/list?term="+e.nowTerm._id,n=(new Date).getTime();t.get(o+"&t="+n,null,{responseType:"json"}).success(function(o){console.log("拉取老师分组成功！",o.result),0===o.err?(e.teacherGroup=o.result,e.teacherGroup.length>0&&(e.nowTeacherGroup=e.teacherGroup[0]),_.each(o.result,function(o){e.teacherGroupMap[o._id]=o})):e.$emit(MSG,o.err)}).error(function(){})};return{getTeacherGroupList:i,importTeacherGroup:n,importTeacher:r}}]),angular.module("ov.services.question",["ov.constant","ov.services.utils"]).service("questionService",["$rootScope","$location","$http","Util",function(e,o,t,n){var r=function(e){var o=((new Date).getTime(),"/api/questionnaire/import"),t=new XMLHttpRequest;t.addEventListener("load",function(){try{var e=JSON.parse(t.responseText);console.log(e)}catch(o){}}),t.addEventListener("error",function(e){console.log("error",e)}),t.open("POST",o),t.send(e)},i=function(o,r,i){var a=(new Date).getTime(),c=n.object.toUrlencodedString(o);t.post("/api/questionnaire/create?_="+a,c,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(o,t){console.log(o),0===o.err?(e.questionList.push(o.result),console.log("新建问卷成功!",o)):e.$emit(MSG,o.err),r&&r(o,t)}).error(function(e,o){i&&i(e,o)})},a=function(){var o="/api/questionnaire/list?term="+e.nowTerm._id,n=(new Date).getTime();t.get(o+"&t="+n,null,{responseType:"json"}).success(function(o){console.log("拉取问卷分组成功！",o.result),0===o.err?(e.questionList=o.result,e.questionList.length>0&&(e.nowQuestion=e.questionList[0])):e.$emit(MSG,o.err)}).error(function(){})};return{getQuestionList:a,importQuestion:r,createQuestion:i}}]),angular.module("ov.services.utils",[]).service("Util",[function(){var e={object:{toUrlencodedString:function(e){return _.map(e,function(e,o){return encodeURIComponent(o)+"="+encodeURIComponent(e)}).join("&")}},getParameter:function(e){var o=new RegExp("(\\?|#|&)"+e+"=([^&#]*)(&|#|$)"),t=location.href.match(o);return decodeURIComponent(t?t[2]:"")},cookie:{get:function(e){var o=document.cookie.split("; "),t=_.reduce(o,function(e,o){var t=o.split("=");return e[t[0]]=t[1],e},{});return t[e]},set:function(e){var o=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=$.trim(t[n]);if(r.substring(0,e.length+1)==e+"="){o=decodeURIComponent(r.substring(e.length+1));break}}return o}},time:{timezoneOffset:(new Date).getTimezoneOffset(),dateToDatetimePickerValue:function(o,t){return o||(o=new Date),o.setMinutes(o.getMinutes()-e.time.timezoneOffset),t||(o.setSeconds(0),o.setMilliseconds(0)),o.toISOString().split(".")[0]},datetimePickerValueToTs:function(o){if(o){var t=o.split(":").length<3?":00.000Z":".000Z",n=Date.parse(o+t)+60*e.time.timezoneOffset*1e3;return console.log(o,n,new Date(n)),n}return 0}}};return e}]),angular.module("ov.controllers.nav",["ov.constant"]).controller("navController",["$rootScope","$scope",function(){console.log("load navController")}]),angular.module("ov.controllers.toolbar",["ov.constant","ov.services.utils","ov.services.login"]).controller("toolbarController",["$rootScope","$scope","Util","loginService",function(e,o,t,n){console.log("load toolbarController"),t.cookie.get("skey")||(console.log("not login"),n.teacherLogin())}]),angular.module("ov.controllers.import",["ov.constant","ov.services.quota"]).controller("quotaController",["$rootScope","$scope","quotaService","STATUS.TERM.LOAD",function(e,o,t,n){console.log("load quotaController"),e.quotaGroupList=[],e.quotaGroupMap={},e.nowQuotaGroup={},e.quotaList=[],e.newQuotaGroup={},o.quotaOrder={name:0,order:0,gatherType:0,score:0},o.quotaScoreOrder={},o.orderQuotaGroup=function(n){o.quotaOrder[n]=!o.quotaOrder[n],t.orderQuotaGroup(e.nowQuotaGroup._id,n,o.quotaOrder[n]),$("#newQuotaGroup").modal("hide")},o.orderQuotaScore=function(){o.quotaScoreOrder[name]=!o.quotaScoreOrder[name]},$("#importFile").bind("change",function(){var o=$(this)[0].files[0],n=new FormData;n.append("file",o),n.append("indicatorGroup",e.nowQuotaGroup._id),e.nowQuotaGroup._id&&t.importQuota(n)}),$("#importQuotaScore").bind("change",function(){var o=$(this)[0].files[0],n=new FormData;n.append("file",o),n.append("indicatorGroup",e.nowQuotaGroup._id),e.nowQuotaGroup._id&&t.importQuotaScore(n)}),e.selectQuotaGroup=function(n){t.setDefQuotaGroup(n);var r=e.nowQuotaGroup.indicators.length;o.quotaScoreOrder={};for(var i=0;r>i;i++)o.quotaScoreOrder[i]=0},e.editQuotaGroup=function(){},e.createQuotaGroup=function(){},e.createNewQuotaGroup=function(){e.newQuotaGroup.term=e.nowTerm._id,t.createQuotaGroup()},e.$on(n,function(){t.getQuotaGroup()})}]),angular.module("ov.controllers.student",["ov.constant","ov.services.student"]).controller("studentController",["$rootScope","$scope","studentService","STATUS.TERM.LOAD",function(e,o,t){console.log("load studentController"),$("#importStudent").bind("change",function(){var o=$(this)[0].files[0],n=new FormData;n.append("file",o),n.append("term",e.nowTerm._id),e.nowQuotaGroup._id&&t.importStudent(n)})}]),angular.module("ov.controllers.teacher",["ov.constant","ov.services.teacher"]).controller("teacherController",["$rootScope","$scope","teacherService","STATUS.TERM.LOAD",function(e,o,t,n){console.log("load teacherController"),e.teacherList=[],e.teacherGroup=[],e.teacherGroupMap={},e.nowTeacherGroup={},$("#importTeacher").bind("change",function(){var o=$(this)[0].files[0],n=new FormData;n.append("file",o),n.append("term",e.nowTerm._id),e.nowQuotaGroup._id&&t.importTeacher(n)}),$("#importTeacherGroup").bind("change",function(){var o=$(this)[0].files[0],n=new FormData;n.append("file",o),n.append("term",e.nowTerm._id),e.nowQuotaGroup._id&&t.importTeacherGroup(n)}),e.changeTeacherGroup=function(o){e.nowTeacherGroup=e.teacherGroupMap[o]},e.$on(n,function(){t.getTeacherGroupList()})}]),angular.module("ov.controllers.question",["ov.constant","ov.services.question"]).controller("questionController",["$rootScope","$scope","questionService","STATUS.TERM.LOAD",function(e,o,t,n){console.log("load questionController"),e.nowQuestion={},e.questionList=[],e.questionName="",e.questionOrder=1,o.questionOrder={name:0,order:0,desc:0,score:0},$("#importQuestion").bind("change",function(){var o=$(this)[0].files[0],n=new FormData;n.append("file",o),n.append("questionnaire",e.nowQuestion._id),e.nowQuotaGroup._id&&t.importQuestion(n)}),e.createQuestion=function(){e.questionName="",e.questionOrder=1,$("#newQuestion").modal("show")},e.createNewQuestion=function(){var o={term:e.nowTerm._id,name:$("#questionName").val(),order:$("#questionOrder").val()};t.createQuestion(o)},e.changeQuestion=function(o){console.log(o),e.nowQuestion=_.find(e.questionList,function(e){return e._id==o})},e.$on(n,function(){t.getQuestionList()})}]),angular.module("ov.controllers.manage",["ov.constant","ov.services.quota"]).controller("manageController",["$rootScope","$scope","$location","quotaService","STATUS.GROUP.LOAD",function(e,o,t){console.log("load manageController"),o.switchMode=function(e){console.log(e,o.getMode()),e!==o.getMode()&&t.search("mode",e)},o.getMode=function(){return t.search().mode||!1}}]),angular.module("ov.controllers.msg",["ov.constant"]).controller("msgController",["$rootScope","$scope","MSG.ERROR.CODE",function(e,o,t){console.log("load msgcontroller"),Messenger().options={extraClasses:"messenger-fixed messenger-on-bottom",theme:"flat"};var n={0:"操作成功!",1001:"您还没有登录!",1004:"没有找到资源!",1010:"您没有查看该资源的权限!",1011:"参数出错啦!",1013:"出错啦",1014:"同名啦,请修改名称!",1015:"已经归档啦!",1016:"该资源不能删除",1017:"该目录下还有其他文件，无法删除!",1041:"用户名或密码错误!",1043:"用户不存在!",1050:"时间交叉了!"};e.$on(t,function(e,o){var t={message:n[o]};parseInt(o)&&(t.type="error"),Messenger().post(t)})}]),function(){angular.module("manage",["ov.controllers.term","ov.controllers.toolbar","ov.controllers.import","ov.controllers.question","ov.controllers.teacher","ov.controllers.student","ov.controllers.msg","ov.controllers.manage"])}();