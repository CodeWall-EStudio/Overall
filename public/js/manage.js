angular.module("ov.services.import",["ov.constant","ov.services.utils"]).service("importService",["$rootScope","$location","$http",function(){var o=function(o,e,t){{var n=(new Date).getTime(),n=(new Date).getTime();Util.object.toUrlencodedString(o)}Http.get("/api/indicator/list?_="+n+"&indicatorGroup="+o.indicatorGroup,null,{responseType:"json"}).success(function(o,t){0===o.code?(console.log("拉学生列表成功!",o),Root.$emit("status.student.load")):Root.$emit("msg.codeshow",o.code),e&&e(o,t)}).error(function(o,e){t&&t(o,e)})};return{getQuotaList:o}}]),angular.module("ov.services.quota",["ov.constant","ov.services.utils"]).service("quotaService",["$rootScope","$location","$http","Util","MSG.ERROR.CODE","STATUS.GROUP.LOAD",function(o,e,t,n,r,i){var a=function(e){e=e||0,o.quotaGroupList.length&&(o.nowQuotaGroup=o.quotaGroupList[e])},u=function(){var e="/api/indicatorgroup/list",n=(new Date).getTime();t.get(e+"?t="+n,null,{responseType:"json"}).success(function(e){console.log("拉取指标组成功！",e.result),0===e.err?(o.quotaGroupList=e.result,a(),o.$emit(i)):o.$emit(r,e.err)}).error(function(){})},c=function(e,i,a){var u=(new Date).getTime(),c=n.object.toUrlencodedString(o.newQuotaGroup);t.post("/api/indicatorgroup/create?_="+u,c,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,t){console.log(e),0===e.err?console.log("新建指标组成功!",e):o.$emit(r,e.err),i&&i(e,t)}).error(function(o,e){a&&a(o,e)})},s=function(e,n,i){var a=(new Date).getTime();t.get("/api/indicator/list?_="+a+"&indicatorGroup="+e.indicatorGroup,null,{responseType:"json"}).success(function(e,t){0===e.err?(o.quotaList=e.result,console.log(o.quotaList),console.log("拉指标列表成功!",e)):o.$emit(r,e.err),n&&n(e,t)}).error(function(o,e){i&&i(o,e)})},l=function(o){var e=((new Date).getTime(),"/api/indicator/import"),t=new XMLHttpRequest;t.addEventListener("load",function(){try{var o=JSON.parse(t.responseText);console.log(o)}catch(e){}}),t.addEventListener("error",function(o){console.log("error",o)}),t.open("POST",e),t.send(o)};return{setDefQuotaGroup:a,getQuotaGroup:u,createQuotaGroup:c,getQuotaList:s,importQuota:l}}]),angular.module("ov.services.utils",[]).service("Util",[function(){var o={object:{toUrlencodedString:function(o){return _.map(o,function(o,e){return encodeURIComponent(e)+"="+encodeURIComponent(o)}).join("&")}},getParameter:function(o){var e=new RegExp("(\\?|#|&)"+o+"=([^&#]*)(&|#|$)"),t=location.href.match(e);return decodeURIComponent(t?t[2]:"")},cookie:{get:function(o){var e=document.cookie.split("; "),t=_.reduce(e,function(o,e){var t=e.split("=");return o[t[0]]=t[1],o},{});return t[o]},set:function(o){var e=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=$.trim(t[n]);if(r.substring(0,o.length+1)==o+"="){e=decodeURIComponent(r.substring(o.length+1));break}}return e}},time:{timezoneOffset:(new Date).getTimezoneOffset(),dateToDatetimePickerValue:function(e,t){return e||(e=new Date),e.setMinutes(e.getMinutes()-o.time.timezoneOffset),t||(e.setSeconds(0),e.setMilliseconds(0)),e.toISOString().split(".")[0]},datetimePickerValueToTs:function(e){if(e){var t=e.split(":").length<3?":00.000Z":".000Z",n=Date.parse(e+t)+60*o.time.timezoneOffset*1e3;return console.log(e,n,new Date(n)),n}return 0}}};return o}]),angular.module("ov.controllers.nav",["ov.constant"]).controller("navController",["$rootScope","$scope",function(){console.log("load navController")}]),angular.module("ov.controllers.toolbar",["ov.constant"]).controller("toolbarController",["$rootScope","$scope",function(){console.log("load toolbarController")}]),angular.module("ov.controllers.import",["ov.constant","ov.services.quota"]).controller("quotaController",["$rootScope","$scope","quotaService","STATUS.GROUP.LOAD",function(o,e,t,n){console.log("load quotaController"),o.quotaGroupList=[],o.nowQuotaGroup={},o.quotaList=[],o.newQuotaGroup={name:"test"},$("#importFile").bind("change",function(){var e=$(this)[0].files[0],n=new FormData;n.append("file",e),n.append("indicatorGroup",o.nowQuotaGroup._id),o.nowQuotaGroup._id&&t.importQuota(n)}),o.selectQuotaGroup=function(e){t.setDefQuotaGroup(e),o.$emit(n)},o.editQuotaGroup=function(){},o.createQuotaGroup=function(){},o.createNewQuotaGroup=function(){t.createQuotaGroup()},t.getQuotaGroup(),o.$on(n,function(){var e={indicatorGroup:o.nowQuotaGroup._id};t.getQuotaList(e)})}]),angular.module("ov.controllers.manage",["ov.constant","ov.services.quota"]).controller("manageController",["$rootScope","$scope","quotaService","STATUS.GROUP.LOAD",function(){console.log("load manageController")}]),angular.module("ov.controllers.msg",["ov.constant"]).controller("msgController",["$rootScope","$scope","MSG.ERROR.CODE",function(o,e,t){console.log("load msgcontroller"),Messenger().options={extraClasses:"messenger-fixed messenger-on-bottom",theme:"flat"};var n={0:"操作成功!",1001:"您还没有登录!",1004:"没有找到资源!",1010:"您没有查看该资源的权限!",1011:"参数出错啦!",1013:"出错啦",1014:"同名啦,请修改名称!",1015:"已经归档啦!",1016:"该资源不能删除",1017:"该目录下还有其他文件，无法删除!",1041:"用户名或密码错误!",1043:"用户不存在!",1050:"时间交叉了!"};o.$on(t,function(o,e){var t={message:n[e]};parseInt(e)&&(t.type="error"),Messenger().post(t)})}]),function(){angular.module("manage",["ov.controllers.toolbar","ov.controllers.import","ov.controllers.msg","ov.controllers.manage"])}();