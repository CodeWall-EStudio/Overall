angular.module("ov.services.term",["ov.constant","ov.services.utils"]).service("termService",["$rootScope","$location","$http","Util","MSG.ERROR.CODE","STATUS.TERM.LOAD",function(o,e,r,t,n,i){function c(e){if(e)_.each(o.termList,function(r){return r._id===e?void(o.nowTerm=r):void 0});else{var r=o.termList[0];_.each(o.termList,function(e){return 1===e.status?void(o.nowTerm=e):void 0}),o.nowTerm=r}}function s(e){return e?_.find(o.termList,function(o){return o._id==e}):!1}function u(e){_.each(o.termList,function(r,t){r._id===e._id&&(o.termList[t]=e)})}var a=function(e,i,c){var s=(new Date).getTime(),u=t.object.toUrlencodedString(e);r.post("/api/term/create?_="+s,u,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,r){console.log(e),0===e.err?(o.termList.push(e.result),console.log("新建学期成功!",e)):o.$emit(n,e.err),i&&i(e,r)}).error(function(o,e){c&&c(o,e)})},l=function(e,i,c){var s=(new Date).getTime(),a=t.object.toUrlencodedString(e);r.post("/api/term/modify?_="+s,a,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,r){0===e.err?(u(e.result),console.log("新建学期成功!",e)):o.$emit(n,e.err),i&&i(e,r)}).error(function(o,e){c&&c(o,e)})},p=function(e,i,c){var s=(new Date).getTime(),u=t.object.toUrlencodedString(e);r.post("/api/term/create?_="+s,u,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,r){console.log(e),0===e.err?console.log("新建学期成功!",e):o.$emit(n,e.err),i&&i(e,r)}).error(function(o,e){c&&c(o,e)})},d=function(e,s,u){{var a=(new Date).getTime();t.object.toUrlencodedString(o.param)}r.get("/api/term/list?_="+a,null,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,r){0===e.err?(o.termList=e.result,c(),o.$emit(i),console.log("拉学期成功!",e.result)):o.$emit(n,e.err),s&&s(e,r)}).error(function(o,e){u&&u(o,e)})};return{getTermList:d,createTerm:a,modifyTerm:l,delTerm:p,changeDefTerm:c,getOneTerm:s}}]),angular.module("ov.services.report",["ov.constant","ov.services.utils"]).service("reportService",["$rootScope","$location","$http","MSG.ERROR.CODE",function(o,e,r,t){function n(e,n,i){e=e||{};var c=(new Date).getTime(),s="/api/indicatorscore/report?_="+c+"&term="+o.nowTerm._id;s+=e.teacherGroup?"&teacherGroup="+e.teacherGroup:"&teacherGroup="+o.nowTeacherGroup._id,s+=e.indicatorGroup?"&indicatorGroup="+e.indicatorGroup:"&indicatorGroup="+o.nowQuotaGroup._id,r.get(s,null,{responseType:"json"}).success(function(e,r){0===e.err?(o.reportList=e.result,console.log("拉报表成功",e.result)):o.$emit(t,e.err),n&&n(e,r)}).error(function(o,e){i&&i(o,e)})}function i(e,n,i){e=e||{};var c=(new Date).getTime(),s="/api/indicatorscore/detail?_="+c;r.get(s,null,{responseType:"json"}).success(function(e,r){0===e.err||o.$emit(t,e.err),n&&n(e,r)}).error(function(o,e){i&&i(o,e)})}return{getReportList:n,getOneReport:i}}]),angular.module("ov.services.login",["ov.constant","ov.services.utils"]).service("loginService",["$rootScope","$location","$http","Util","MSG.ERROR.CODE","LOGINED",function(o,e,r,t,n){function i(){var o="/api/login";location.href=o}function c(e,i,c){var s=(new Date).getTime(),u=t.object.toUrlencodedString(e);r.post("/api/login/student?_="+s,u,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,r){0===e.err?window.location="/overall.html":o.$emit(n,e.err),i&&i(e,r)}).error(function(o,e){c&&c(o,e)})}return{teacherLogin:i,studentLogin:c}}]),angular.module("ov.services.teacher",["ov.constant","ov.services.utils"]).service("teacherService",["$rootScope","$location","$http",function(o,e,r){var t=function(o){var e=((new Date).getTime(),"/api/teachergroup/import"),r=new XMLHttpRequest;r.addEventListener("load",function(o){console.log(o);try{var e=JSON.parse(r.responseText);console.log(e)}catch(o){}}),r.addEventListener("error",function(o){console.log("error",o)}),r.open("POST",e),r.send(o)},n=function(o){var e=((new Date).getTime(),"/api/teacher/import"),r=new XMLHttpRequest;r.addEventListener("load",function(){try{var o=JSON.parse(r.responseText);console.log(o)}catch(e){}}),r.addEventListener("error",function(o){console.log("error",o)}),r.open("POST",e),r.send(o)},i=function(){var e="/api/teachergroup/list?term="+o.nowTerm._id,t=(new Date).getTime();r.get(e+"&t="+t,null,{responseType:"json"}).success(function(e){console.log("拉取老师分组成功！",e.result),0===e.err?(o.teacherGroup=e.result,o.teacherGroup.length>0&&(o.nowTeacherGroup=o.teacherGroup[0]),_.each(e.result,function(e){o.teacherGroupMap[e._id]=e})):o.$emit(MSG,e.err)}).error(function(){})};return{getTeacherGroupList:i,importTeacherGroup:t,importTeacher:n}}]),angular.module("ov.services.quota",["ov.constant","ov.services.utils"]).service("quotaService",["$rootScope","$location","$http","Util","MSG.ERROR.CODE","STATUS.QUOTA.LOAD",function(o,e,r,t,n,i){var c=function(e){e=e||0,o.quotaGroupList.length&&(o.nowQuotaGroup=o.quotaGroupList[e],o.$emit(i))},s=function(){var e="/api/indicatorgroup/list?term="+o.nowTerm._id,t=(new Date).getTime();r.get(e+"&t="+t,null,{responseType:"json"}).success(function(e){console.log("拉取指标组成功！",e.result),0===e.err?(o.quotaGroupList=e.result,_.each(e.result,function(e){o.quotaGroupMap[e._id]=e}),c()):o.$emit(n,e.err)}).error(function(){})},u=function(e,i,c){var s=(new Date).getTime(),u=t.object.toUrlencodedString(o.newQuotaGroup);r.post("/api/indicatorgroup/create?_="+s,u,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,r){console.log(e),0===e.err&&(o.quotaGroupList.push(e.result),o.quotaGroupMap[e.result._id]=e.result,console.log("新建指标组成功!",e)),o.$emit(n,e.err),i&&i(e,r)}).error(function(o,e){c&&c(o,e)})},a=function(){return},l=function(){},p=function(e,t,i){var c=(new Date).getTime();r.get("/api/indicator/list?_="+c+"&indicatorGroup="+e.indicatorGroup,null,{responseType:"json"}).success(function(e,r){0===e.err?(o.quotaList=e.result,console.log(o.quotaList),console.log("拉指标列表成功!",e)):o.$emit(n,e.err),t&&t(e,r)}).error(function(o,e){i&&i(o,e)})},d=function(o){var e=((new Date).getTime(),"/api/indicator/import"),r=new XMLHttpRequest;r.addEventListener("load",function(){try{var o=JSON.parse(r.responseText);console.log(o)}catch(e){}}),r.addEventListener("error",function(o){console.log("error",o)}),r.open("POST",e),r.send(o)},f=function(o){var e=((new Date).getTime(),"/api/indicatorscore/import"),r=new XMLHttpRequest;r.addEventListener("load",function(){try{var o=JSON.parse(r.responseText);console.log(o)}catch(e){}}),r.addEventListener("error",function(o){console.log("error",o)}),r.open("POST",e),r.send(o)},m=function(e,r,t){var n=o.quotaGroupMap[e].indicators,i=_.sortBy(n,function(o){return t?(console.log("-",o,r),-o[r]):(console.log("+",o,r),+o[r])});o.quotaGroupMap[e].indicators=i};return{setDefQuotaGroup:c,getQuotaGroup:s,createQuotaGroup:u,getQuotaList:p,importQuota:d,importQuotaScore:f,orderQuotaGroup:m,getQuotaScore:a,setQuotaScore:l}}]),angular.module("ov.services.user",["ov.constant","ov.services.utils"]).service("userService",["$rootScope","$location","$http","Util","MSG.ERROR.CODE","STATUS.USER.LOAD",function(o,e,r,t,n,i){function c(){var e="/api/user/info";r.get(e,null,{responseType:"json"}).success(function(e){0===e.err?(o.my=e.result,o.$emit(i)):o.$emit(n,e.err)}).error(function(){})}function s(e,t,i){e=e||{};var c=(new Date).getTime(),s="/api/user/search?_="+c;e.keyword&&(s+="&=keyword="+e.keyword),r.get(s,null,{responseType:"json"}).success(function(e,r){0===e.err?(o.userList=e.result,console.log("搜索用户成功",e.result)):o.$emit(n,e.err),t&&t(e,r)}).error(function(o,e){i&&i(o,e)})}function u(){var e="/api/user/import";r.get(e,null,{responseType:"json"}).success(function(e){o.$emit(n,e.err)}).error(function(){})}return{getUserInfo:c,importUser:u,searchUser:s}}]),angular.module("ov.services.utils",[]).service("Util",[function(){var o={object:{toUrlencodedString:function(o){return _.map(o,function(o,e){return encodeURIComponent(e)+"="+encodeURIComponent(o)}).join("&")}},getParameter:function(o){var e=new RegExp("(\\?|#|&)"+o+"=([^&#]*)(&|#|$)"),r=location.href.match(e);return decodeURIComponent(r?r[2]:"")},cookie:{get:function(o){var e=document.cookie.split("; "),r=_.reduce(e,function(o,e){var r=e.split("=");return o[r[0]]=r[1],o},{});return r[o]},set:function(o){var e=null;if(document.cookie&&""!=document.cookie)for(var r=document.cookie.split(";"),t=0;t<r.length;t++){var n=$.trim(r[t]);if(n.substring(0,o.length+1)==o+"="){e=decodeURIComponent(n.substring(o.length+1));break}}return e}},time:{timezoneOffset:(new Date).getTimezoneOffset(),dateToDatetimePickerValue:function(e,r){return e||(e=new Date),e.setMinutes(e.getMinutes()-o.time.timezoneOffset),r||(e.setSeconds(0),e.setMilliseconds(0)),e.toISOString().split(".")[0]},datetimePickerValueToTs:function(e){if(e){var r=e.split(":").length<3?":00.000Z":".000Z",t=Date.parse(e+r)+60*o.time.timezoneOffset*1e3;return console.log(e,t,new Date(t)),t}return 0}}};return o}]),angular.module("ov.controllers.nav",["ov.constant"]).controller("navController",["$rootScope","$scope",function(){console.log("load navController")}]),angular.module("ov.controllers.grade",["ov.constant"]).controller("gradeController",["$rootScope","$scope",function(){}]),angular.module("ov.controllers.import",["ov.constant","ov.services.quota"]).controller("quotaController",["$rootScope","$scope","quotaService","STATUS.TERM.LOAD","STATUS.QUOTA.LOAD","STATUS.QUOTAGROUP.CHANGE",function(o,e,r,t,n,i){console.log("load quotaController"),o.quotaGroupList=[],o.quotaGroupMap={},o.nowQuotaGroup={},o.quotaList=[],o.newQuotaGroup={},o.quotaScoreList={},e.quotaOrder={name:0,order:0,gatherType:0,score:0},e.quotaScoreOrder={},e.orderQuotaGroup=function(t){e.quotaOrder[t]=!e.quotaOrder[t],r.orderQuotaGroup(o.nowQuotaGroup._id,t,e.quotaOrder[t]),$("#newQuotaGroup").modal("hide")},e.orderQuotaScore=function(){e.quotaScoreOrder[name]=!e.quotaScoreOrder[name]},$("#importFile").bind("change",function(){var e=$(this)[0].files[0],t=new FormData;t.append("file",e),t.append("indicatorGroup",o.nowQuotaGroup._id),console.log(o.nowQuotaGroup),o.nowQuotaGroup._id&&r.importQuota(t)}),$("#importQuotaScore").bind("change",function(){var e=$(this)[0].files[0],t=new FormData;t.append("file",e),t.append("indicatorGroup",o.nowQuotaGroup._id),o.nowQuotaGroup._id&&r.importQuotaScore(t)}),o.selectQuotaGroup=function(t){r.setDefQuotaGroup(t);var n=o.nowQuotaGroup.indicators.length;e.quotaScoreOrder={};for(var c=0;n>c;c++)e.quotaScoreOrder[c]=0;o.$emit(i)},o.editQuotaGroup=function(){},o.createQuotaGroup=function(){},o.createNewQuotaGroup=function(){o.newQuotaGroup.term=o.nowTerm._id,r.createQuotaGroup()},o.$on(t,function(){r.getQuotaGroup()}),o.$on(n,function(){})}]),angular.module("ov.controllers.report",["ov.constant","ov.services.report"]).controller("reportController",["$rootScope","$scope","reportService","STATUS.USER.LOAD","STATUS.TERM.LOAD","STATUS.QUOTA.LOAD","STATUS.TERM.CHANGE","STATUS.TEACHERGROUP.CHANGE","STATUS.QUOTAGROUP.CHANGE",function(o,e,r,t,n,i,c,s,u){o.reportList=[];var a=!1,l=!1;o.$on(n,function(){a=!0}),o.$on(i,function(){l=!0,l&&a&&r.getReportList()}),o.$on(t,function(){console.log("load")}),o.$on(c,function(){r.getReportList()}),o.$on(s,function(){r.getReportList()}),o.$on(u,function(){r.getReportList()})}]),angular.module("ov.controllers.reportmore",["ov.constant","ov.services.report"]).controller("reportMoreController",["$rootScope","$scope",function(){}]),angular.module("ov.controllers.reportinfo",["ov.constant","ov.services.report"]).controller("reportInfoController",["$rootScope","$scope",function(){}]),angular.module("ov.controllers.toolbar",["ov.constant","ov.services.utils","ov.services.login"]).controller("toolbarController",["$rootScope","$scope","Util","loginService",function(o,e,r,t){console.log("load toolbarController"),r.cookie.get("skey")||(console.log("not login"),t.teacherLogin())}]),angular.module("ov.controllers.teacher",["ov.constant","ov.services.teacher"]).controller("teacherController",["$rootScope","$scope","teacherService","STATUS.TERM.LOAD","STATUS.TEACHERGROUP.CHANGE",function(o,e,r,t,n){console.log("load teacherController"),o.teacherList=[],o.teacherGroup=[],o.teacherGroupMap={},o.nowTeacherGroup={},$("#importTeacher").bind("change",function(){var e=$(this)[0].files[0],t=new FormData;t.append("file",e),t.append("term",o.nowTerm._id),o.nowTerm._id&&r.importTeacher(t)}),$("#importTeacherGroup").bind("change",function(){var e=$(this)[0].files[0],t=new FormData;t.append("file",e),t.append("term",o.nowTerm._id),o.nowTerm._id&&r.importTeacherGroup(t)}),o.changeTeacherGroup=function(e){o.nowTeacherGroup=o.teacherGroupMap[e],o.$emit(n)},o.$on(t,function(){r.getTeacherGroupList()})}]),angular.module("ov.controllers.user",["ov.constant","ov.services.utils","ov.services.user"]).controller("userController",["$rootScope","$scope","Util","userService","STATUS.USER.LOAD",function(o,e,r,t,n){console.log("load userController"),o.my={},o.userList=[],t.getUserInfo(),o.showUser=function(o){console.log(o)},o.$on(n,function(){t.searchUser()})}]),angular.module("ov.controllers.index",["ov.constant","ov.services.quota"]).controller("indexController",["$rootScope","$scope","$location",function(o,e,r){console.log("load indexController"),o.myInfo={},o.gradelist=[],o.teacherGroup={0:"班主任",1:"科任老师",2:"行政员工"},e.switchMode=function(o){o!==e.getMode()&&r.search("mode",o)},e.getMode=function(){return r.search().mode||!1}}]),angular.module("ov.controllers.msg",["ov.constant"]).controller("msgController",["$rootScope","$scope","$location","MSG.ERROR.CODE",function(o,e,r,t){console.log("load msgcontroller"),Messenger().options={extraClasses:"messenger-fixed messenger-on-bottom",theme:"flat"};var n=(r.absUrl(),{0:"操作成功!",1001:"您还没有登录!",1004:"没有找到资源!",1010:"您没有查看该资源的权限!",1011:"参数出错啦!",1013:"出错啦",1014:"同名啦,请修改名称!",1015:"已经归档啦!",1016:"该资源不能删除",1017:"该目录下还有其他文件，无法删除!",1041:"用户名或密码错误!",1043:"用户不存在!",1050:"时间交叉了!"});o.$on(t,function(o,e){if(1001===e){var r="/api/login";return void(location.href=r)}var t={message:n[e]};parseInt(e)&&(t.type="error"),Messenger().post(t)})}]),function(){angular.module("index",["ov.controllers.report","ov.controllers.reportmore","ov.controllers.reportinfo","ov.controllers.toolbar","ov.controllers.term","ov.controllers.teacher","ov.controllers.user","ov.controllers.index","ov.controllers.import","ov.controllers.msg"])}();